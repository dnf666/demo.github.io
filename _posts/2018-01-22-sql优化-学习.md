---
layout:     post
title:      sql优化
subtitle:   性能
date:       2018-01-22
author:     戴林甫
header-img: img/post-bg-ios9-web.jpg
catalog: true
tags:
    - java
    - 性能
---

### 优化sql的一般步骤

#### 通过show status 命令了解sql的执行频率

    show status like 'Com_%';

### 定位执行效率低的sql
    
    通过慢查询的方式定位
    1.查看mysql是否开启慢查询日志
    
    show variables like 'slow_query_log';
    
    2.设置没有索引的记录到慢查询日志
    
    set global log_queries_not_using_indexes=on;
    
    3查看超过多长时间的记录到慢查询日志
    
    show variables like 'long_query_time';
    
    4.开启慢查询日志
    
    set global slow_query_log=on;
    
### 用explain解释低效sql
    mysql> explain select * from actor where actor_id>=1\G;
    *************************** 1. row ***************************
               id: 1
      select_type: SIMPLE
            table: actor
             type: range
    possible_keys: PRIMARY
              key: PRIMARY
          key_len: 2
              ref: NULL
             rows: 200
            Extra: Using where
    1 row in set (0.01 sec)
    
    解释一下上面各属性什么意思
    
    select_type:select的类型 常见得有以下几种
    simple：单表查询
    primary：主查询
    union：union中的第二个或者后面的查询语句
    subquery：子查询中的第一个select
    
    table ：查询的表
    type： 访问类型（包括：all，index，range，ref，eq_ref,const或system，null）
    性能从左到右，越来越好
    
    type:从表中找到所需行的方式（all,index,range,ref,eq_ref,const/system,null）
    all:搜索全表
    index：遍历整个索引
    ref：非唯一索引扫描和唯一索引的前缀扫描，返回一个单独值的记录行
    eq_ref:使用唯一索引。
    const/system：单表中最多一个行 比如根据主键和唯一索引
    null：不用访问表，就能得到结果